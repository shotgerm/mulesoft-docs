:toc:               left
:toc-title:         AMQP Connector
:toclevels:         2
:last-update-label!:
:docinfo:
:source-highlighter: coderay
:icons: font


= AMQP Connector Documentation Reference

+++
AmqpConnector is a AMQP 0.9.1 compliant MuleSoft Extension, used to consume and produce AMQP Messages. The Extension supports AMQP functionality including exchanges and queues, consumers, acknowledgement modes and local transactions.
+++


== Configurations
---
[[config]]
=== Config

+++
Base configuration for AmqpConnector
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Name | String | The name for this configuration. Connectors reference the configuration with this name. | | *x*{nbsp}
| Encoding a| String |  +++The default encoding of the Message body to be used if the message doesn't communicate it+++ |  | {nbsp}
| Content Type a| String |  +++The default contentType of the Message body to be used if the message doesn't communicate it+++ |  +++*/*+++ | {nbsp}
| Create Fallback Queue |  +++Whether non existing queues will be created according to the fallback definition in case they are defined.+++ |  +++true+++ | {nbsp}
| Create Fallback Exchange |  +++Whether non existing exchanges will be created according to the fallback definition in case they are defined.+++ |  +++true+++ | {nbsp}
|======================

+++
Configuration for Consumers
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Ack Mode a| Enumeration, one of:

** IMMEDIATE
** AUTO
** MANUAL
 |  +++The ConsumerAckMode to use when consuming a Message Can be overridden at the message source level. +++ |  +++AUTO+++ | {nbsp}
 | No Local | Boolean | If set to true, the server does not send messages to the connection that published them. |false | {nbsp}
 | Exclusive Consumers | Boolean | Set to true if the connector should only create exclusive consumers, i.e. only the created consumer can access the queue. | false | {nbsp}
 | Number of Consumers | Integer | It is the number of consumers spawned by message source to receive AMQP messages. Each consumer will create a channel. | 4 | {nbsp}
|======================

+++
Configuration for Publishers
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Delivery Mode | Enumeration, one of:
 
** PERSISTENT
** TRANSIENT
 |  +++the delivery mode use when publishing to the AMQP broker.+++ |  +++PERSISTENT+++ | {nbsp}
 | Priority | Integer | The priority to use when publishing to the AMQP broker. | 0 | {nbsp}
 | Request Broker Confirms | Boolean | Whether it must fail in case no confirmation is provided. | false | {nbsp}
 | Mandatory | Boolean | Whether the operation must fail if the message cannot be routed to a queue. | false | {nbsp}
 | Immediate | Boolean | Whether the operation must fail if the message cannot be routed to a queue consumer immediately. | false | {nbsp}
 | Returned Message Exchange | String | The exchange to publish returned messages. | {nbsp} | {nbsp}
 
|======================

+++
Configuration for Quality of Service
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Prefetch Size | Integer | This field defines a prefetch size window. The broker will send as much messages as possible without exceeding the prefetchSize window in octets (bytes). 0 is used for no specific limit. | 0 | {nbsp}
| Prefetch Count | Integer | Specifies a global prefetch window in terms of whole messages. This field may be used in combination with the prefetch-size field; a message will only be sent in advance if both prefetch windows allow it. 0 is used for no specific limit. | 0 | {nbsp}
|======================

==== Associated Operations
* <<consume>> {nbsp}
* <<publish>> {nbsp}
* <<publishConsume>> {nbsp}
* <<ack>> {nbsp}
* <<reject>> {nbsp}

==== Associated Sources
* <<listener>> {nbsp}


== Operations

[[consume]]
=== Consume
`<amqp:consume>`

+++
Operation that allows the user to consume a single AmqpMessage from a given Queue.
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | | *x*{nbsp}
| Queue name a| String |  +++The name of the queue from where the Message should be consumed+++ |  | *x*{nbsp}
| Content Type a| String |  +++the Message's content content type+++ |  | {nbsp}
| Encoding a| String |  +++the Message's content encoding+++ |  | {nbsp}
| Fallback Queue Definition| Definition of a Queue |  +++The queue definition to use for queue declaration in case there is no queue with the queueName+++ |  | {nbsp}
| Ack Mode a| Enumeration, one of:

** IMMEDIATE
** MANUAL |  +++the ConsumerAckMode that will be configured over the Message and Session+++ |  | {nbsp}
| Maximum Wait a| Number |  +++maximum time to wait for a message before timing out+++ |  +++10000+++ | {nbsp}
| Maximum Wait Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  +++Time unit to be used in the maximumWaitTime configurations+++ |  +++MILLISECONDS+++ | {nbsp}
| Transactional Action a| Enumeration, one of:

** ALWAYS_JOIN
** JOIN_IF_POSSIBLE
** NOT_SUPPORTED |  +++The type of joining action that operations can take regarding transactions.+++ |  +++JOIN_IF_POSSIBLE+++ | {nbsp}
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  +++A retry strategy in case of connectivity errors+++ |  | {nbsp}
|======================

==== Output
[cols=".^50%,.^50%"]
|======================
| *Type* a| Any
| *Attributes Type* a| <<AmqpAttributes>>
|======================

==== For Configurations.
* <<config>> {nbsp}

==== Throws
* AMQP:TIMEOUT {nbsp}
* AMQP:CONNECTIVITY {nbsp}
* AMQP:CONSUMING {nbsp}
* AMQP:RETRY_EXHAUSTED {nbsp}
* AMQP:QUEUE_NOT_FOUND {nbsp}
* AMQP:CREATION_NOT_ALLOWED {nbsp}


[[publish]]
=== Publish
`<amqp:publish>`

+++
Operation that allows the user to publish a single AmqpMessage to a given exchange
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | | *x*{nbsp}
| Exchange Name a| String |  +++The name of the exchange to publish the message to+++ |  | *x*{nbsp}
| Fallback Exchange Definition| Definition of an Exchange |  +++The exchange to use for exchange declaration in case there is no exchange with the exchangeName+++ |  | {nbsp}
| Routing Keys| LIST |  +++List of routing keys+++ |  | {nbsp}
| Delivery Mode | Enumeration, one of:
 
** PERSISTENT
** TRANSIENT
 |  +++the delivery mode use when publishing to the AMQP broker.+++ |  +++PERSISTENT+++ | {nbsp}
| Correlation Id a| String |  +++The AMQPCorrelationID header of the Message+++ |  | {nbsp}
| ContentType a| String |  +++The content type of the body+++ |  | {nbsp}
| Encoding a| String |  +++The outboundEncoding of the message's body+++ |  | {nbsp}
| Reply To a| String |  +++The AMQP replyTo property information of the Queue where this Message should be replied to+++ |  | {nbsp}
| User Properties a| Object |  +++The custom user properties that should be set for this Message. Each property is merged with other default AMQP user properties. All the AMQP user properties are set at once in a single Object. You can write this object as a DataWeave object, such as `#[output application/json --- { userName: vars.user, appName: 'myApp'}]`. Each key/value from the user properties object is then set as a separate AMQP user property. +++ |  | {nbsp}
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  +++A retry strategy in case of connectivity errors+++ |  | {nbsp}
|======================


==== For Configurations.
* <<config>> {nbsp}

==== Throws
* AMQP:PUBLISHING {nbsp}
* AMQP:UNROUTABLE_MESSAGE {nbsp}
* AMQP:CREATION_NOT_ALLOWED {nbsp}
* AMQP:ILLEGAL_BODY {nbsp}
* AMQP:RETRY_EXHAUSTED {nbsp}


[[publishConsume]]
=== Publish Consume
`<amqp:publish-consume>`

+++
Operation that allows the user to send a message to a AMQP Exchange and waits for a response either to the provided replyTo destination or to a temporary destination created dynamically
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | {nbsp}| *x*{nbsp}
| Exchange Name |  String | +++The name of the exchange to publish the message to+++ | {nbsp}  | *x*{nbsp}
| Correlation Id a| String |  +++The AMQPCorrelationID header of the Message+++ | {nbsp} | {nbsp}
| ContentType a| String |  +++The content type of the body+++ | */* | {nbsp}
| Encoding a| String |  +++The outboundEncoding of the message's body+++ | {nbsp} | {nbsp}
| User Properties a| Object |  +++The custom user properties that should be set for this Message. Each property is merged with other default AMQP user properties. All the AMQP user properties are set at once in a single Object. You can write this object as a DataWeave object, such as `#[output application/json --- { userName: vars.user, appName: 'myApp'}]`. Each key/value from the user properties object is then set as a separate AMQP user property. +++ |  | {nbsp}
| Maximum Wait a| Number |  +++maximum time to wait for a message before timing out+++ |  +++10000+++ | {nbsp}
| Maximum Wait Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  +++Time unit to be used in the maximumWaitTime configurations+++ |  +++MILLISECONDS+++ | {nbsp}
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  +++A retry strategy in case of connectivity errors+++ |  | {nbsp}
|======================

==== Output
[cols=".^50%,.^50%"]
|======================
| *Type* a| Any
| *Attributes Type* a| <<AMQPAttributes>>
|======================

==== For Configurations.
* <<config>> {nbsp}

==== Throws
* AMQP:PUBLISHING_CONSUMING {nbsp}
* AMQP:PUBLISHING {nbsp}
* AMQP:TIMEOUT {nbsp}
* AMQP:CONNECTIVITY {nbsp}
* AMQP:CONSUMING {nbsp}
* AMQP:ILLEGAL_BODY {nbsp}
* AMQP:RETRY_EXHAUSTED {nbsp}
* AMQP:QUEUE_NOT_FOUND {nbsp}
* AMQP:CREATION_NOT_ALLOWED {nbsp}


[[ack]]
=== Ack
`<amqp:ack>`

+++
Operation that allows the user to ack a delivered AmqpMessage.
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Ack Id a| String |  +++The AckId of the Message to ACK+++ |  | *x*{nbsp}
|======================

[[reject]]
=== Reject
`<amqp:reject>`

+++
Operation that allows the user to reject a delivered AmqpMessage.
+++

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Ack Id a| String |  +++The AckId of the Message to ACK+++ |  | *x*{nbsp}
| Requeue a| Boolean |  +++Indicates whether the rejected message has to be requeued+++ | false | {nbsp}
|======================

== Sources

[[listener]]
=== Listener
`<amqp:listener>`

+++
AMQP Listener for Queues, allows to listen for incoming messages. 
+++

==== Listener Configuration Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Configuration | String | The name of the configuration to use. | | *x*{nbsp}
| Queue Name a| String |  +++Name of the queue to consume from+++ |  | *x*{nbsp}
| Number Of consumers a| Number |  +++The number of concurrent consumers that will be used to receive AMQP Messages+++ |  +++4+++ | {nbsp}
| Consumer Tag a| String |  +++A client-generated consumer tag to establish context.+++ |  +++4+++ | {nbsp}
| Recover Strategy | Enumeration, one of:
 
** NONE
** NO_REQUEUE
** REQUEUE 	| Strategy to use when a channel recover or a rollback is performed.| EXPLICIT | {nbsp}
| Inbound content type a| String |  +++The content type of the message body+++ |  | {nbsp}
| Inbound encoding a| String |  +++The inboundEncoding of the message body+++ |  | {nbsp}
|======================

== Types
[[RedeliveryPolicy]]
=== Redelivery Policy

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Max Redelivery Count a| Number | The maximum number of times a message can be redelivered and processed unsuccessfully before triggering process-failed-message |  | 
| Use Secure Hash a| Boolean | Whether to use a secure hash algorithm to identify a redelivered message |  | 
| Message Digest Algorithm a| String | The secure hashing algorithm to use. If not set, the default is SHA-256. |  | 
| Id Expression a| String | Defines one or more expressions to use to determine when a message has been redelivered. This property may only be set if useSecureHash is false. |  | 
| Object Store a| <<ObjectStore>> | The object store where the redelivery counter for each message is going to be stored. |  | 
|======================

[[reconnect]]
=== Reconnect

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often (in ms) to reconnect |  | 
| Count a| Number | How many reconnection attempts to make |  | 
|======================

[[reconnect-forever]]
=== Reconnect Forever

[cols=".^20%,.^25%,.^30%,.^15%,.^10%", options="header"]
|======================
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often (in ms) to reconnect |  | 
|======================

[[queue-definition]]
== Queue Definition

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Removal Strategy | Enumeration, one of:
 
** EXPLICIT
** SHUTDOWN
** UNUSED | Defines when the declared queue must be removed from the broker. | EXPLICIT | {nbsp}
| Exchange to Bind | String | Defines the exchange to bind the queue to. | {nbsp} | *x*{nbsp}
|======================

[[exchange-definition]]
== Exchange Definition

==== Parameters
[cols=".^20%,.^20%,.^35%,.^20%,^.^5%", options="header"]
|======================
| Name | Type | Description | Default Value | Required
| Removal Strategy | Enumeration, one of:
 
** EXPLICIT
** SHUTDOWN
** UNUSED 	
 | Defines when the declared exchange must be removed from the broker.| EXPLICIT | {nbsp}
| Exchange Type | Enumeration, one of:

** DIRECT
** TOPIC
** FANOUT
** HEADERS 
 | The type of the exchange to be declared| FANOUT | {nbsp}
|======================




