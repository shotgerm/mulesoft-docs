= About the AMQP Connector
:keywords: amqp, connector, amqp_0_9_1

The AMQP connector enables your application to do messaging using an AMQP 0.9.1 compliant broker. Its main features include:

* RPC Pattern through request-reply consumption using private temporal queues
* SDK Transaction management with optional channel self-recovery
* Synchronous Message requesting, with timeout
* Management operations for exchange and queues declarations. 
* All AMQP message properties, including custom headers
* Reply to (publishing replies to the default exchange)
* Automatic, Mule-driven and manual message acknowledgement
* Manual message reject
* Mandatory and immediate publishing parameters and handling of returned (undelivered) messages through exception handling.
* Prefetch size and count "quality of service" settings
* noLocal and exclusive consumers
* SSL connectivity
* Message Builder functionality similar to the one provided by the AMQP Mule 4 Connector

[[configuration_settings]]
== Configuring the Connector

Out of the box, the AMQP connector comes with a fine tuned set of default values, both for publishing and consuming messages. This means that the only requirement is for you to configure which connection should be used.

This example sets a minimal connection to a broker in localhost:

[source, xml, linenums]
----
<amqp:config name="AMQP_Config">
  <amqp:connection host="localhost" username="guest" password="guest" />
</amqp:config>
----

=== Defining Global Defaults

The AMQP `config` allows you to define multiple parameters that will be used as a default while consuming or publishing messages. This way, you can define a global default behaviour for all the operations associated the config and then override each parameter only in the operations that require a custom behaviour.

For example, we can define a prefetch size window in terms of size and in terms of whole messages.

[source, xml, linenums]
----
<amqp:config name="AMQP_Config">
   <amqp:connection host="localhost" username="guest" password="guest" />
   <amqp:quality-of-service-config prefetchSize="4" prefetchCount="4" />
   <amqp:consumer-config ackMode="IMMEDIATE" />
   <amqp:publisher-config requestBrokerConfirms="true"/>
</amqp:config>
----

In this case, every operation `consume` or `listener` associated to this config will use have an acknowledge mode of type `IMMEDIATE`, while every time we do a `publish` or `publish-consume`, the outgoing Message will request a confirm from the broker.

All of this properties can be overridden at operation level when required. Let`s say we need to `publish` a message that does not require confirms from the broker:

[source, xml, linenums]
----
<amqp:publish config-ref="AMQP_Config" requestBrokerConfirms="false"/>
----

== Connecting to a Broker
A AMQP connection is defined by a set of general parameters that apply for any connection:

=== Providing Credentials For Authentication

In order to establish an authenticated connection, you have to set the `username`, `password`, and the `virtualhost` in the `connection` element:

[source, xml, linenums]
----
<amqp:config name="AMQP_Config">
  <amqp:connection host="localhost" virtualhost="/" username=g"uest" password="guest" />
</amqp:config>
----

=== Setting SSL Connectivity to the Broker

Using the parameter `useTls` you can create a secure connection to the broker using the default TLS Context or defining a TLS Context as a child element in the connection or as global element in the following way:

[source, xml, linenums]
----
<tls:context name="globalTlsContext">
  <tls:trust-store path="tls/ssltest-cacerts.jks"
    password="changeit" />
  <tls:key-store path="tls/ssltest-keystore.jks"
    keyPassword="changeit" password="changeit" />
</tls:context>

<amqp:config name="config">
  <amqp:connection host="localhost" port="5671"
    virtualHost="/" username="guest" password="guest" useTls="true"
    tlsContext="globalTlsContext" />
 </amqp:config>
----
== See Also

* link:amqp-consume[How Consume Messages]
* link:amqp-publish[How Publish Messages]
* link:amqp-listener[How Listen For New Messages]
* link:amqp-publish-consume[How Listen For A Reply]
* link:amqp-ack[Handling Message Acknowledgement]
* link:amqp-transactions[Handling Transactions in AMQP]
* link:amqp-documentation[AMQP Connector Technical Reference]
